
﻿(function(fw){fw.Firework=Firework;function Firework(sx,sy,tx,ty){this.x=sx;this.y=sy;this.sx=sx;this.sy=sy;this.tx=tx;this.ty=ty;this.distanceToTarget=fw.calculateDistance(sx,sy,tx,ty);this.distanceTraveled=0;this.coordinates=[];this.coordinateCount=fw.options.fireworkTrailLength;while(this.coordinateCount--){this.coordinates.push([this.x,this.y])}
this.angle=Math.atan2(ty-sy,tx-sx)
this.speed=fw.options.fireworkSpeed;this.acceleration=fw.options.fireworkAcceleration;this.brightness=fw.random(fw.options.fireworkBrightnessRange[0],fw.options.fireworkBrightnessRange[1]);this.targetRadius=fw.options.fireworkTargetRadius;}
Firework.prototype.update=function(index){this.coordinates.pop();this.coordinates.unshift([this.x,this.y])
if(this.targetRadius<5){this.targetRadius+=0.3;}else{this.targetRadius=1;}
this.speed*=this.acceleration;var vx=Math.cos(this.angle)*this.speed;var vy=Math.sin(this.angle)*this.speed;this.distanceTraveled=fw.calculateDistance(this.sx,this.sy,this.x+vx,this.y+vy);if(this.distanceTraveled>this.distanceToTarget){fw.createParticles(this.tx,this.ty);fw.fireworks.splice(index,1);}else{this.x+=vx;this.y+=vy;}}
Firework.prototype.draw=function(){fw.ctx.beginPath();fw.ctx.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]);fw.ctx.lineTo(this.x,this.y);fw.ctx.strokeStyle='hsl('+fw.hue+',100%,'+this.brightness+'%)';fw.ctx.stroke();fw.ctx.beginPath();fw.ctx.arc(this.tx,this.ty,this.targetRadius,0,360*Math.PI/180);fw.ctx.stroke();}})(window.Fireworks=window.Fireworks||{});﻿(function(fw,window){window.requestAnimationFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,1000/60);};})();(function setWidthHeight(){var docElement=window.document.documentElement,body=window.document.getElementsByTagName('body')[0],width=window.innerWidth||docElement.clientWidth||body.clientWidth,height=window.innerHeight||docElement.clientHeight||body.clientHeight;fw.canvas=document.createElement("canvas");fw.canvas.id="fireworks-field";fw.canvas.style.position="fixed";fw.canvas.style.top=0;fw.canvas.style.left=0;fw.canvas.style.bottom=0;fw.canvas.style.right=0;fw.canvas.style.zIndex=100000;fw.canvas.style.pointerEvents="none";window.document.body.appendChild(fw.canvas);fw.canvas.width=width;fw.canvas.height=height;})();fw.ctx=fw.canvas.getContext('2d');fw.cw=fw.canvas.clientWidth;fw.ch=fw.canvas.clientHeight;fw.options=new fw.Options();fw.fireworks=[];fw.particles=[];fw.hue=fw.options.hue;fw.random=function random(min,max){return Math.random()*(max-min)+min;};fw.calculateDistance=function calculateDistance(p1x,p1y,p2x,p2y){var xD=p1x-p2x;var yD=p1y-p2y;return Math.sqrt(Math.pow(xD,2)+Math.pow(yD,2))}
fw.createParticles=function createParticles(x,y){var particleCount=fw.options.particleCount;while(particleCount--){fw.particles.push(new fw.Particle(x,y))}}
var limiterTotal=fw.options.limiterTotal;var limiterTick=fw.options.limiterTick;var timerTotal=fw.options.timerTotal;var timerTick=fw.options.timerTick;var mx;var my;var mousedown=false;fw.init=function loop(options){if(options!=null){fw.options=new fw.Options(options);reInitializeOptions();}
window.requestAnimationFrame(loop.bind(null,null));fw.hue+=fw.options.hueStep;fw.ctx.globalCompositeOperation='destination-out';fw.ctx.fillStyle=fw.options.ctxFillStyle;fw.ctx.fillRect(0,0,fw.cw,fw.ch);fw.ctx.globalCompositeOperation='lighter'
var fireworkIndex=fw.fireworks.length;while(fireworkIndex--){fw.fireworks[fireworkIndex].draw();fw.fireworks[fireworkIndex].update(fireworkIndex);}
var particleIndex=fw.particles.length;while(particleIndex--){fw.particles[particleIndex].draw();fw.particles[particleIndex].update(particleIndex);}
if(timerTick>=timerTotal){if(!mousedown){fw.fireworks.push(new fw.Firework(fw.cw/2,fw.ch,fw.random(0,fw.cw),fw.random(0,fw.ch/2)));timerTick=fw.options.timerTick;}}else{timerTick++;}
if(limiterTick>=limiterTotal){if(mousedown){fw.fireworks.push(new fw.Firework(fw.cw/2,fw.ch,mx,my));limiterTick=fw.options.limiterTick;}}else{limiterTick++;}}
fw.canvas.addEventListener('mousemove',function(e){mx=e.pageX-fw.canvas.offsetLeft;my=e.pageY-fw.canvas.offsetTop;});fw.canvas.addEventListener('mousedown',function(e){e.preventDefault();mousedown=true;});fw.canvas.addEventListener('mouseup',function(e){e.preventDefault();mousedown=false;});function reInitializeOptions(){fw.hue=fw.options.hue;limiterTotal=fw.options.limiterTotal;limiterTick=fw.options.limiterTick;timerTotal=fw.options.timerTotal;timerTick=fw.options.timerTick;}})(window.Fireworks=window.Fireworks||{},window);﻿(function(fw){fw.Options=Options;function Options(options){if(options===undefined){options={};}
if(options.width!==undefined){if(options.width<0){options.width=fw.cw+options.width;}
this.width=options.width;fw.cw=options.width;fw.canvas.width=options.width;}
if(options.height!==undefined){if(options.height<0){options.height=fw.ch+options.height;}
this.height=options.height;fw.ch=options.height;fw.canvas.height=options.height;}
this.limiterTotal=options.limiterTotal||5;this.limiterTick=options.limiterTick||0;this.timerTotal=options.timerTotal||100;this.timerTick=options.timerTick||0;this.hue=options.hue||180;this.hueStep=options.hueStep||0.5;this.ctxFillStyle=options.ctxFillStyle||'rgba(0,0,0,0.4)';this.fireworkTrailLength=options.fireworkTrailLength||3;this.fireworkSpeed=options.fireworkSpeed||2;this.fireworkAcceleration=options.fireworkAcceleration||1.05;this.fireworkBrightnessRange=options.fireworkBrightnessRange||[50,80];this.fireworkTargetRadius=options.fireworkTargetRadius||1;this.particleTrailLength=options.particleTrailLength||5;this.particleCount=options.particleCount||30;this.particleSpeedRange=options.particleSpeedRange||[1,10];this.particleFriction=options.particleFriction||0.95;this.particleGravity=options.particleGravity||1;this.particleHueRange=options.particleHueRange||[15,15];this.particleBrightnessRange=options.particleBrightnessRange||[50,80];this.particleAlpha=options.particleAlpha||1;this.particleDecayRange=options.particleDecayRange||[0.015,0.03];}})(window.Fireworks=window.Fireworks||{});﻿(function(fw){fw.Particle=Particle;function Particle(x,y){this.x=x;this.y=y;this.coordinates=[];this.coordinateCount=fw.options.particleTrailLength;while(this.coordinateCount--){this.coordinates.push([this.x,this.y])}
this.angle=fw.random(0,360*Math.PI/180);this.speed=fw.random(fw.options.particleSpeedRange[0],fw.options.particleSpeedRange[1]);this.friction=fw.options.particleFriction;this.gravity=fw.options.particleGravity;this.hue=fw.random(fw.hue-fw.options.particleHueRange[0],fw.hue+fw.options.particleHueRange[1])
this.brightness=fw.random(fw.options.particleBrightnessRange[0],fw.options.particleBrightnessRange[1]);this.alpha=fw.options.particleAlpha;this.decay=fw.random(fw.options.particleDecayRange[0],fw.options.particleDecayRange[1]);}
Particle.prototype.update=function(index){this.coordinates.pop();this.coordinates.unshift([this.x,this.y]);this.speed*=this.friction;this.x+=Math.cos(this.angle)*this.speed;this.y+=Math.sin(this.angle)*this.speed+this.gravity;this.alpha-=this.decay;if(this.alpha<=this.decay){fw.particles.splice(index,1);}}
Particle.prototype.draw=function(){fw.ctx.beginPath();fw.ctx.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]);fw.ctx.lineTo(this.x,this.y);fw.ctx.strokeStyle='hsla('+this.hue+', 100%, '+this.brightness+'%, '+this.alpha+')';fw.ctx.stroke();}})(window.Fireworks=window.Fireworks||{});